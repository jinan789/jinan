<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Question 3: Polaris - CS 161 Project 1</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Question 3: Polaris | CS 161 Project 1</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Question 3: Polaris" /> <meta property="og:locale" content="en_US" /> <link rel="canonical" href="http://localhost:4000/question3.html" /> <meta property="og:url" content="http://localhost:4000/question3.html" /> <meta property="og:site_name" content="CS 161 Project 1" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Question 3: Polaris" /> <script type="application/ld+json"> {"headline":"Question 3: Polaris","url":"http://localhost:4000/question3.html","@type":"WebPage","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> CS 161 Project 1 </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/story.html" class="nav-list-link">Story</a></li><li class="nav-list-item"><a href="http://localhost:4000/getting-started.html" class="nav-list-link">Getting Started</a></li><li class="nav-list-item"><a href="http://localhost:4000/customizing.html" class="nav-list-link">Customizing</a></li><li class="nav-list-item"><a href="http://localhost:4000/question1.html" class="nav-list-link">Question 1: Remus</a></li><li class="nav-list-item"><a href="http://localhost:4000/question2.html" class="nav-list-link">Question 2: Spica</a></li><li class="nav-list-item active"><a href="http://localhost:4000/question3.html" class="nav-list-link active">Question 3: Polaris</a></li><li class="nav-list-item"><a href="http://localhost:4000/question4.html" class="nav-list-link">Question 4: Vega</a></li><li class="nav-list-item"><a href="http://localhost:4000/question5.html" class="nav-list-link">Question 5: Deneb</a></li><li class="nav-list-item"><a href="http://localhost:4000/question6.html" class="nav-list-link">Question 6: Rigel</a></li><li class="nav-list-item"><a href="http://localhost:4000/submission.html" class="nav-list-link">Submission Summary</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search CS 161 Project 1" aria-label="Search CS 161 Project 1" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="polaris-launched-1998"> <a href="#polaris-launched-1998" class="anchor-heading" aria-labelledby="polaris-launched-1998"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Polaris (Launched 1998) </h1> <ul> <li><em>Password</em>: tolearn</li> <li>(20 points)</li> </ul> <details open=""> <summary class="text-delta"> Table of contents </summary> <ol id="markdown-toc"> <li><a href="#starter-files" id="markdown-toc-starter-files">Starter files</a></li> <li><a href="#your-task" id="markdown-toc-your-task">Your task</a></li> <li><a href="#the-interact-api" id="markdown-toc-the-interact-api">The interact API</a></li> <li><a href="#debugging" id="markdown-toc-debugging">Debugging</a></li> <li><a href="#tips" id="markdown-toc-tips">Tips</a></li> <li><a href="#deliverables" id="markdown-toc-deliverables">Deliverables</a></li> </ol> </details> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The Spica logs seem to be definitive proof of EvanBot’s existence, but without
further clues, you seem to have hit a dead end. Luckily, some time later, CSA
assigns you to deorbit Polaris, a former Gobian spy satellite.

As the space race became more competitive, newer Gobian Union satellites like
Polaris introduced stack canaries to protect top-secret information from enemy spies.
Although stack canaries were considered state-of-the-art defense at the time, we now
know that they can be defeated.

Hack into Polaris to see what intelligence it contains, and don’t forget to deorbit it
afterwards
</code></pre></div></div> <p>For this question, stack canaries are enabled. The stack canary in this question is 4 random bytes (no null byte) that change each time you run the program. We recommend trying Q1 on HW2 before attempting this question.</p><hr /> <h2 id="starter-files"> <a href="#starter-files" class="anchor-heading" aria-labelledby="starter-files"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Starter files </h2> <p>The vulnerable <code class="language-plaintext highlighter-rouge">dehexify</code> program takes an input and converts it so that its hexadecimal escapes are decoded into the corresponding ASCII characters. Any non-hexadecimal escapes are outputted as-is. For example:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./dehexify
<span class="se">\x</span>41<span class="se">\x</span>42   <span class="c"># outputs AB</span>
XYZ        <span class="c"># outputs XYZ</span>
<span class="c"># Control-D ends input</span>
</code></pre></div></div> <p>Note that we are not inputting the byte <code class="language-plaintext highlighter-rouge">\x41</code> here. Instead, we are inputting a literal backslash and the literal characters <code class="language-plaintext highlighter-rouge">x</code>, <code class="language-plaintext highlighter-rouge">4</code>, and <code class="language-plaintext highlighter-rouge">1</code>.</p> <p>Also note that you can decode multiple inputs within a single execution of a program.</p><hr /> <h2 id="your-task"> <a href="#your-task" class="anchor-heading" aria-labelledby="your-task"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Your task </h2> <p>Your exploit for this question will go in an <code class="language-plaintext highlighter-rouge">interact</code> script instead of a <code class="language-plaintext highlighter-rouge">egg</code> script. To get started, copy over the starter code and make it writable by running:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp </span>interact.scaffold interact
<span class="nb">chmod</span> +w interact
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">exploit</code> script simply runs your <code class="language-plaintext highlighter-rouge">interact</code> script three times in a row (since your solution might have a small chance of failure.)</p><hr /> <h2 id="the-interact-api"> <a href="#the-interact-api" class="anchor-heading" aria-labelledby="the-interact-api"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The interact API </h2> <p>The <code class="language-plaintext highlighter-rouge">interact</code> script lets you send multiple inputs and read multiple outputs from a program. In particular, you have access to the following variables and functions:</p> <ol> <li> <p><code class="language-plaintext highlighter-rouge">SHELLCODE</code>: This variable contains the shellcode that you should execute. Rather than opening a shell, it prints the <code class="language-plaintext highlighter-rouge">README</code> file, which contains the password. Note that this is different from the shellcode in the previous two questions.</p> </li> <li> <p><code class="language-plaintext highlighter-rouge">p.send(s)</code>: This function sends a string <code class="language-plaintext highlighter-rouge">s</code> to the C program. You must include a newline <code class="language-plaintext highlighter-rouge">\n</code> at the end your input string <code class="language-plaintext highlighter-rouge">s</code> (this is like pushing “Enter” when manually typing input). The newline is not sent to the C program.</p> </li> <li> <p><code class="language-plaintext highlighter-rouge">p.recv(n)</code>: This function reads <code class="language-plaintext highlighter-rouge">n</code> bytes from the C program’s output.</p> </li> </ol> <p>As an example, we can write the session from before using this API.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">'</span><span class="se">\\</span><span class="s">x41</span><span class="se">\\</span><span class="s">x42'</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>  <span class="c1"># newline not sent to C program
</span><span class="k">assert</span> <span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="s">'BC</span><span class="se">\n</span><span class="s">'</span>   <span class="c1"># newline printed by C program
</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">'XYZ'</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
<span class="n">foo</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>              <span class="c1"># save C program output in a variable
</span><span class="k">assert</span> <span class="n">foo</span> <span class="o">==</span> <span class="s">'XYZ</span><span class="se">\n</span><span class="s">'</span>
</code></pre></div></div> <p>Note that in Python, to send a literal backslash character, you must escape it as <code class="language-plaintext highlighter-rouge">\\</code>.</p><hr /> <h2 id="debugging"> <a href="#debugging" class="anchor-heading" aria-labelledby="debugging"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Debugging </h2> <p>Input and output redirection does not work in this question, because it involves multiple inputs and outputs. Instead, you will need to type your desired input into gdb directly:</p> <ol> <li> <p>Run <code class="language-plaintext highlighter-rouge">./debug-exploit</code> to start gdb.</p> </li> <li> <p>Set appropriate breakpoints and <code class="language-plaintext highlighter-rouge">layout split</code> if desired.</p> </li> <li> <p>Start the program without any arguments (<code class="language-plaintext highlighter-rouge">run</code> or <code class="language-plaintext highlighter-rouge">r</code>).</p> </li> <li> <p>When you step over the call to <code class="language-plaintext highlighter-rouge">gets</code>, gdb will wait for your input. Type in your input and hit enter.</p> </li> </ol> <p>Note that you cannot type special byte characters directly into gdb. For example, if you type <code class="language-plaintext highlighter-rouge">\x12</code>, gdb will input a literal backslash and the literal characters <code class="language-plaintext highlighter-rouge">x</code>, <code class="language-plaintext highlighter-rouge">1</code>, and <code class="language-plaintext highlighter-rouge">2</code>.</p> <p>Additionally, you can use print statements in your <code class="language-plaintext highlighter-rouge">interact</code> script for debugging. These will be directly printed to the terminal (and not sent to the program). For example, the following line prints out the Python variable <code class="language-plaintext highlighter-rouge">foo</code> as hex characters:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">" "</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">"{:02x}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">foo</span><span class="p">))</span>
</code></pre></div></div><hr /> <h2 id="tips"> <a href="#tips" class="anchor-heading" aria-labelledby="tips"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tips </h2> <ul> <li> <p><strong>Important</strong>: In this question, <code class="language-plaintext highlighter-rouge">gets</code> appends <em>two</em> null bytes after your input, not one. This will affect your exploit slightly.</p> </li> <li> <p>You might want to save some C program output and input part of it back into the C program. No hex decoding or little-endian reversing is necessary to do this. For example:</p> </li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">foo</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>  <span class="c1"># receive 12 bytes of output
</span>        <span class="n">bar</span> <span class="o">=</span> <span class="n">foo</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span>    <span class="c1"># slice the second word of the output
</span>        <span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span>       <span class="c1"># send the second word back to the C program
</span></code></pre></div></div> <ul> <li>In the second p.send, <code class="language-plaintext highlighter-rouge">m != 16</code>. If you have <code class="language-plaintext highlighter-rouge">m = 16</code>, notice that the function doesn’t immediately return after the gets call. Make sure to account for the extra logic so that the stack is set up correctly when the function returns.</li> </ul><hr /> <h2 id="deliverables"> <a href="#deliverables" class="anchor-heading" aria-labelledby="deliverables"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Deliverables </h2> <p>A script <code class="language-plaintext highlighter-rouge">interact</code> and a <a href="question1.html#example-write-up">writeup</a>. Make sure the script works by running <code class="language-plaintext highlighter-rouge">./exploit</code>.</p> <p><strong>Note</strong>: It may be difficult to show GDB output for this question. For this question only, it’s sufficient to show the GDB output after your first input to the program, along with a stack diagram showing how any future inputs would conceptually change the stack.</p><hr /> <p><img src="/images/frontier.jpg" alt="frontier" /></p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
